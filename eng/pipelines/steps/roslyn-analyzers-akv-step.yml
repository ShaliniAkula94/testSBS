#################################################################################
# Licensed to the .NET Foundation under one or more agreements.                 #
# The .NET Foundation licenses this file to you under the MIT license.          #
# See the LICENSE file in the project root for more information.                #
#################################################################################

# @TODO: This should be made generic if possible once build.proj is disassembled
# @TODO: Test this without signing, or indicate that this depends on the signing key is downloaded

parameters:
    - name: buildConfiguration
      type: string

    - name: mdsPackageVersion
      type: string

steps:
    - task: securedevelopmentteam.vss-secure-development-tools.build-task-roslynanalyzers.RoslynAnalyzers@3
      displayName: 'Roslyn Analyzers'
      inputs:
          msBuildArchitecture: x64
#          msBuildCommandLine: 'msbuild $(REPO_ROOT)/build.proj -t:BuildAkv -p:BuildTools=false -p:Configuration=${{ parameters.buildConfiguration }} -p:GenerateNuGet=false -p:NugetPackageVersion=${{ parameters.mdsPackageVersion }} -p:ReferenceType=Package -p:SigningKeyPath=$(Agent.TempDirectory)\netfxKeypair.snk'
          msBuildCommandLine: >-
            msbuild
            $(REPO_ROOT)/build.proj
            -t:BuildAkv
            -p:BuildTools=false
            -p:Configuration=${{ parameters.buildConfiguration }}
            -p:GenerateNuGet=false
            -p:NugetPackageVersion=${{ parameters.mdsPackageVersion }}
            -p:ReferenceType=Package
            -p:SigningKeyPath=$(Agent.TempDirectory)\netfxKeypair.snk
          msBuildVersion: 17.0
          setupCommandLinePicker: vs2022
