#################################################################################
# Licensed to the .NET Foundation under one or more agreements.                 #
# The .NET Foundation licenses this file to you under the MIT license.          #
# See the LICENSE file in the project root for more information.                #
#################################################################################

# For more details, see https://www.osgwiki.com/wiki/Symbols_Publishing_Pipeline_to_SymWeb_and_MSDL

parameters:
    - name: referenceType
      type: string
      values:
          - project
          - package

    - name: searchPattern
      type: string

    - name: symbolsArtifactName
      type: string

    - name: symbolsProduct
      type: string

    - name: symbolsVersion
      type: string

variables:
    - template: '../variables/symbol-publishing-variables.yml'

    - # Allegedly needed for downstream tasks
      name: ArtifactServices.Symbol.AccountName
      value: '${{ variables.SymbolAccount }}'

steps:
    - task: PublishSymbols@2
      displayName: 'Upload symbols to ${{ variables.SymbolAccount }} org'
      inputs:
          IndexSources: false
          Pat: '$(System.AccessToken)'
          SearchPattern: '${{ parameters.searchPattern }}'
          SymbolExpirationInDays: 1825 # 5 years
          SymbolServerType: 'TeamServices'
          SymbolsArtifactName: '${{ parameters.symbolsArtifactName }}'
          SymbolsFolder: '$(ARTIFACT_PATH)/${{ parameters.referenceType }}/bin'
          SymbolsMaximumWaitTime: 60
          SymbolsProduct: '${{ parameters.symbolsProduct }}'
          SymbolsVersion: '${{ parameters.symbolsVersion }}'

    - template: './azure-cli-publish-symbols-step.yml@self'
      parameters:
          azureSubscription: "${{ variables.AzureSubscription }}"
          projectName: "${{ variables.ProjectName }}"
          publishToInternal: true
          publishToPublic: true
          symbolServer: "${{ variables.SymbolServer }}"
          symbolTokenUri: "${{ variables.SymbolTokenUri }}"
          symbolsArtifactName: "${{ parameters.SymbolsArtifactName }}"


