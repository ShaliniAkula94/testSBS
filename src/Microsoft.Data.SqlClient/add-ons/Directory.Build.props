<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  
  <!-- Import the closest parent Directory.build.props, wherever it happens to be. -->
  <Import Project="$([MSBuild]::GetPathOfFileAbove('Directory.Build.props', '$(MSBuildThisFileDirectory)../'))" />
  
  <PropertyGroup>
    <ReferenceType Condition="'$(ReferenceType)'==''">Project</ReferenceType>
    <AllowedOutputExtensionsInPackageBuildOutputFolder>$(AllowedOutputExtensionsInPackageBuildOutputFolder);.pdb</AllowedOutputExtensionsInPackageBuildOutputFolder>
    <ContinuousIntegrationBuild>true</ContinuousIntegrationBuild>
    <TargetFrameworkMonikerAssemblyAttributesPath>$([System.IO.Path]::Combine('$(IntermediateOutputPath)','$(TargetFramework)','$(TargetFrameworkMoniker).AssemblyAttributes$(DefaultLanguageSourceExtension)'))</TargetFrameworkMonikerAssemblyAttributesPath>
  </PropertyGroup>

  <!--These properties can be modified locally to target .NET version of choice to build and test entire test suite-->
  <PropertyGroup>
    <TargetNetFxVersion Condition="'$(TargetNetFxVersion)' == '' AND '$(TF)' != ''">$(TF)</TargetNetFxVersion>
    <TargetNetFxVersion Condition="'$(TargetNetFxVersion)' == ''">net462</TargetNetFxVersion>
    <TargetNetCoreVersion Condition="'$(TargetNetCoreVersion)' == '' AND '$(TF)' != ''">$(TF)</TargetNetCoreVersion>
    <TargetNetCoreVersion Condition="'$(TargetNetCoreVersion)' == ''">net8.0;net9.0</TargetNetCoreVersion>
  </PropertyGroup>

  <ItemGroup>
    <EmbeddedFiles Include="$(GeneratedAssemblyInfoFile)"/>
  </ItemGroup>
  
  <!--
    When building via build.proj, the build targets imply either .NET or .NET
    Framework (never both), so restrict the target frameworks accordingly.
  -->
  <PropertyGroup Condition="'$(BuildProj)' == 'true'">
    <TargetFrameworks Condition="'$(TargetsNetFx)' == 'true'">$(TargetNetFxVersion)</TargetFrameworks>
    <TargetFrameworks Condition="'$(TargetsNetFx)' != 'true'">$(TargetNetCoreVersion)</TargetFrameworks>
  </PropertyGroup>
  <!-- Otherwise, allow all target frameworks. -->
  <PropertyGroup Condition="'$(BuildProj)' != 'true'">
    <TargetFrameworks>$(TargetNetCoreVersion);$(TargetNetFxVersion)</TargetFrameworks>
  </PropertyGroup>
</Project>
